<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hf.project.common.mapper.common.PurchaseRequestMapper">

    <select id="query" resultMap="PurchaseRequestMap" parameterType="java.util.List">
        SELECT
        a.QGNo,
        '福建华峰运动用品科技有限公司莆田分公司' groupName,
        b.CItem,
        b.Matno,
        '福建省莆田市荔城区北高镇坑园村岭头268号' groupAddress,
        b.QG_Qty,
        a.QGDt,
        c.PNL,
        d.NcUnit
        FROM mat_QG a WITH(NOLOCK)
        JOIN dbo.mat_QG_C b WITH(NOLOCK) ON a.QGNo=b.QGNo
        LEFT JOIN  rt_UsersList c WITH(NOLOCK) ON a.Creater=c.ChName
        LEFT JOIN mat_KCandCGDW d WITH(NOLOCK) ON b.KCDW=d.Unit and b.CGDW = d.CGUnit
        WHERE a.QGNo IN
        <foreach collection="list" index="index" item="item" open="(" close=")" separator=",">
            #{item}
        </foreach>
    </select>

    <resultMap id="PurchaseRequestMap" type="PurchaseRequest">
        <result column="CItem" jdbcType="VARCHAR" property="itemId" />
        <result column="QGNo" jdbcType="VARCHAR" property="billCode" />
        <result column="groupName" jdbcType="VARCHAR" property="purOraName" />
        <result column="Matno" jdbcType="VARCHAR" property="materialCode" />
        <result column="NcUnit" jdbcType="VARCHAR" property="materialUnitCode" />
        <result column="groupAddress" jdbcType="VARCHAR" property="planPersonReceiveAddress" />
        <result column="groupName" jdbcType="VARCHAR" property="receiveOrgName" />
        <result column="PNL" jdbcType="VARCHAR" property="reqContactCode" />
        <result column="QGDt" jdbcType="TIMESTAMP" property="reqDate" />
        <result column="groupName" jdbcType="VARCHAR" property="planPsnOrgName" />
        <result column="QG_Qty" jdbcType="DECIMAL" property="materialAmounts" />
    </resultMap>

    <select id="existRequestDlt" parameterType="java.util.Map" resultType="java.lang.Boolean">
        SELECT
		CASE WHEN EXISTS(
                SELECT 1
                FROM mat_QG a WITH(NOLOCK)
                JOIN dbo.mat_QG_C b  WITH(NOLOCK) ON a.QGNo = b.QGNo
                WHERE a.QGNo  = #{billCode} AND b.CItem = #{id} ) THEN 1
		ELSE 0
		END
    </select>
</mapper>
